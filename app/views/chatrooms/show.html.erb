<div class="header">
  <%= link_to dashboard_path, class: "back-button" do %>
    <i class="fa-solid fa-arrow-left"></i>
  <% end %>

  <h1 class="header-title" style="margin-right:35px;">Chatroom</h1>

</div>

<div class='chatroom' data-controller="chatroom-subscription"
  data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>">
  <div class="chatroom__messages" data-chatroom-subscription-target="list">
    <div data-chatroom-subscription-target="messages" class="chatroom__messages-container">
      <% @chatroom.messages.order(created_at: :asc).each do |message| %>
        <%= render "messages/message", message: message %>
      <% end %>
    </div>
  </div>


  <div class="chatroom__form">
    <%= simple_form_for [@chatroom, Message.new], html: {
      data: {
        controller: "mentions",
        action: "keyup->mentions#keyup turbo:submit-end->chatroom-subscription#resetForm",
      }
    } do |f| %>
      <div data-mentions-target="suggestions" class="suggestions-container d-none"></div>
      <div style="position:relative">
        <%= f.input :content,
            label: false,
            input_html: {
              data: {
                mentions_target: "input"
              },
              placeholder: "Message ##{@chatroom.name}"
            },
            wrapper_html: { class: "" }
          %>
        <label for="file-upload" class="file-upload-label">
          <i class="fa-solid fa-paperclip"></i>
        </label>
        <%= f.file_field :file, id: "file-upload", class: "file-upload-input", accept: 'application/pdf/png,image/jpeg', style: "display: none;" %>
      </div>
      <%= f.submit "Send", class: "submit-comment-btn", id:"submit-chatroom" %>
    <% end %>
  </div>
</div>
