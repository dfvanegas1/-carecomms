<div class="container">
<div class=background-container>
  <h1 class="text-center my-4">My tasks</h1>

  <div class="row mb-3">
    <div class="col">
      <% if policy(Task).create? %>
        <%= link_to new_task_path, class: 'add-task-btn' do %>
          Add Task
          <span class="add-task-icon">+</span>
        <% end %>
      <% end %>
    </div>
    <div class="col">
      <%= form_tag tasks_path, method: :get, class: "filter-form" do %>
        <%= select_tag :priority, options_for_select({'High' => '3', 'Medium' => '2', 'Low' => '1'}, selected: params[:priority]), include_blank: 'All', onchange: 'this.form.submit()' %>
        <i class="fa-solid fa-caret-down select-caret"></i>

        <% if current_user.admin? %>
          <%= select_tag :view_option, options_for_select({'All Tasks' => 'all', 'My Tasks' => 'mine'}, selected: params[:view_option]), include_blank: false, onchange: 'this.form.submit()' %>
          <i class="fa-solid fa-caret-down select-caret fa-caret-down-2"></i>
        <% end %>
      <% end %>
    </div>
  </div>
</div>
  <div class="spacer"></div>

<ul class="task-list">
  <% @tasks.each do |task| %>
    <li class="task-item">
      <%= form_with model: task, url: toggle_completion_task_path(task), method: :patch, local: true do |form| %>
        <div class="task-checkbox">
          <%= form.check_box :completed, onchange: "this.form.submit();" %>
        </div>
        <div class="task-content">
          <div class="task-info">
            <%= link_to task.title, task_path(task), class: "task-title" %>
            <div class="progress">
              <div class="progress-bar" role="progressbar" style="width: <%= task.completed ? 100 : 0 %>%" aria-valuenow="<%= task.completed ? 100 : 0 %>" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
          <div class="task-users">
            <% task.user_tasks.each do |user_task| %>
              <%= image_tag(user_task.user.avatar, alt: "#{user_task.user.first_name}'s avatar", class: "task-avatar") if user_task.user.avatar.attached? %>
            <% end %>
          </div>
        </div>
      <% end %>
    </li>
  <% end %>
</ul>
<div class="bottom-spacer"></div>
</div>
